import numpy
from .explicit_runge_kutta import RungeKutta


class ExLRK43(RungeKutta):
    # effective number of stages
    n_stages = 4

    # order of the main method
    order = 4

    # order of the secondary embedded method
    error_estimator_order = 3 #for linear

    # time fraction coefficients (nodes)
    C = numpy.array([0, 0.5,0.5,1])

    # runge kutta coefficient matrix
    A = numpy.array([[0., 0., 0., 0.], \
                     [0.5, 0., 0., 0.],\
                     [0., 0.5, 0., 0.],\
                     [0., 0., 1., 0.]])

    # output coefficients (weights)
    B = numpy.array([1./6., 1./3., 1./3., 1./6.])

    # error coefficients (weights Bh - B)
    E = numpy.array([1./6., 1./3., 1./3., 41./300., 3./100.])
    E[:-1] -= B


class ExLRK32(RungeKutta):
    # effective number of stages
    n_stages = 3

    # order of the main method
    order = 3

    # order of the secondary embedded method
    error_estimator_order = 2 #for both linear and non-linear


    # time fraction coefficients (nodes)
    C = numpy.array([0., 1./2., 1.])

    # runge kutta coefficient matrix
    A = numpy.array([[0., 0., 0.],
      [1/2, 0., 0.],
      [-1., 2., 0.]])

    # output coefficients (weights)
    B = numpy.array([1./6., 2./3., 1./6.])


    # error coefficients (weights Bh - B)
    E = numpy.array([0.25, 0.5, 0.1,0.15])   # B_hat
    E[:-1] -= B


class KC32(RungeKutta):
    # From Kennedy and Carpenter 2003, ARK3_2_4L_2_SA_ERK
    # effective number of stages
    n_stages = 4

    # order of the main method
    order = 3

    # order of the secondary embedded method
    error_estimator_order = 2

    # time fraction coefficients (nodes)
    C = numpy.array([0., 1767732205903/2027836641118, 3/5, 1])

    # runge kutta coefficient matrix
    A = numpy.array([[0., 0., 0., 0.], \
      [1767732205903/2027836641118, 0., 0., 0.], \
      [5535828885825/10492691773637, 788022342437/10882634858940, 0., 0.], \
      [6485989280629/16251701735622, -4246266847089/9704473918619, 10755448449292/10357097424841, 0.]])

    # output coefficients (weights)
    B = numpy.array([1471266399579/7840856788654, -4482444167858/7529755066697, 11266239266428/11593286722821, 1767732205903/4055673282236])

    # error coefficients (weights Bh - B)
    E = numpy.array([ 0.02709926,  0.11013521, -0.10306493, -0.03416955, 0])

class M43(RungeKutta):

    # effective number of stages
    n_stages = 5

    # order of the main method for linear problem 
    order = 4 # order 5 for linear homogenous system 

    # order of the secondary embedded method 
    error_estimator_order = 3 

    # time fraction coefficients (nodes)
    C = numpy.array([0, 1/3, 1/3, 1/2, 1])

    # runge kutta coefficient matrix
    A = numpy.array([
        [0, 0, 0, 0, 0],
        [1/3, 0, 0, 0, 0],
        [1/6, 1/6, 0, 0, 0],
        [1/8, 0, 3/8, 0, 0],
        [1/2, 0, -3/2, 2, 0]])

    # output coefficients (weights)
    B = numpy.array([1/6, 0, 0, 2/3, 1/6])

    # error coefficients (weights Bh - B)
    E = numpy.array([1/10, 0, 3/10, 2/5, 1/5, 0])        # B_hat
    E[:-1] -= B

class BS32(RungeKutta):

    order = 3
    error_estimator_order = 2
    n_stages = 3
    C = numpy.array([0, 1/2, 3/4])
    A = numpy.array([
        [0, 0, 0],
        [1/2, 0, 0],
        [0, 3/4, 0]
    ])
    B = numpy.array([2/9, 1/3, 4/9])
    E = numpy.array([5/72, -1/12, -1/9, 1/8])


class DP54(RungeKutta):
    order = 5
    error_estimator_order = 4
    n_stages = 6
    C = numpy.array([0, 1/5, 3/10, 4/5, 8/9, 1])
    A = numpy.array([
        [0, 0, 0, 0, 0],
        [1/5, 0, 0, 0, 0],
        [3/40, 9/40, 0, 0, 0],
        [44/45, -56/15, 32/9, 0, 0],
        [19372/6561, -25360/2187, 64448/6561, -212/729, 0],
        [9017/3168, -355/33, 46732/5247, 49/176, -5103/18656]
    ])
    B = numpy.array([35/384, 0, 500/1113, 125/192, -2187/6784, 11/84])
    E = numpy.array([-71/57600, 0, 71/16695, -71/1920, 17253/339200, -22/525, 1/40])


class F14_12(RungeKutta):    # Feagin 14/12 method RK1412 in https://github.com/Microno95/desolver/blob/be9c3014c026b8566c9bfa3d37c021736a4a7f99/desolver/integrators/explicit_integration_schemes.py
    order = 14
    error_estimator_order = 12 
    n_stages = 35 
    tableau = numpy.array(
        [[0., 0.,     0.,  0., 0., 0.,  0.,  0., 0., 0.,  0.,  0.,   0., 0.,     0.,     0.,   0.,    0.,  0.,    0.,   0.,  0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0.],
    [11111111111111111./100000000000000000., 11111111111111111./100000000000000000.,     0.,  0., 0., 0.,  0.,  0., 0., 0.,  0.,  0.,   0., 0.,     0.,     0.,   0.,    0.,  0.,    0.,   0.,  0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0., 0.,  0.,  0.],
    [13888888888888889./25000000000000000.,  -83333333333333333./100000000000000000.,    138888888888888889./100000000000000000., 0., 0., 0.,  0.,  0., 0., 0.,  0.,  0.,   0., 0.,     0.,     0.,   0.,    0.,  0.,    0.,   0.,  0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [83333333333333333./100000000000000000., 20833333333333333./100000000000000000.,     0.,  5./8.,                                  0., 0.,  0.,  0., 0., 0.,  0.,  0.,   0., 0.,     0.,     0.,   0.,    0.,  0.,    0.,   0.,  0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [33333333333333333./100000000000000000., 19333333333333333./100000000000000000.,     0.,  11./50.,                                -2./25.,                              0.,  0.,  0., 0., 0.,  0.,  0.,   0., 0.,     0.,     0.,   0.,    0.,  0.,    0.,   0.,  0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [1./1.,                                  1./10., 0.,  0., 2./5.,                                1./2.,                                 0.,  0., 0., 0.,  0.,  0.,   0., 0.,     0.,     0.,   0.,    0.,  0.,    0.,   0.,  0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [16749674481819323./25000000000000000.,  5174228081833989./50000000000000000.,       0.,  0., 6103444365320361./50000000000000000., 24128724516562331./50000000000000000., -381409600015607./10000000000000000.,  0., 0., 0.,  0.,  0.,   0., 0.,     0.,     0.,   0.,    0.,  0.,    0.,   0.,  0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [7426709605345459./25000000000000000.,   12438052665409441./100000000000000000.,     0.,  0., 0., 2261202821975843./10000000000000000.,  1378858876180809./100000000000000000., -1680525334991711./25000000000000000.,  0., 0.,  0.,  0.,   0., 0.,     0.,     0.,   0.,    0.,  0.,    0.,   0.,  0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [72727272727272727./100000000000000000., 4684595328298369./50000000000000000.,       0.,  0., 0., 0.,  -613406843450511./100000000000000000., 10800991281275153./50000000000000000.,  21184753175788097./50000000000000000.,  0.,  0.,  0.,   0., 0.,     0.,     0.,   0.,    0.,  0.,    0.,   0.,  0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [14015279904218877./100000000000000000., 8384798124090527./100000000000000000.,      0.,  0., 0., 0.,  -589746835504869./50000000000000000.,  -4945980411376253./20000000000000000.,  978080858367729./10000000000000000.,    21759068924342063./100000000000000000.,  0.,  0.,   0., 0.,     0.,     0.,   0.,    0.,  0.,    0.,   0.,  0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [35035051988507537./50000000000000000.,  3076276798847141./50000000000000000.,       0.,  0., 0., 0.,  592232780324503./100000000000000000.,  47032615996384111./100000000000000000., 299688863848679./1000000000000000.,     -24765687759399491./100000000000000000., 1386187872142971./12500000000000000.,    0.,   0., 0.,     0.,     0.,   0.,    0.,  0.,    0.,   0.,  0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [9090909090909091./25000000000000000.,   2098500366813913./50000000000000000.,       0.,  0., 0., 0.,  -63597539253241./20000000000000000.,   10079971436327401./12500000000000000.,  975983126412389./10000000000000000.,    77857557815839891./100000000000000000.,  20489042383159943./100000000000000000.,  -39065394906867047./25000000000000000.,   0., 0.,     0.,     0.,   0.,    0.,  0.,    0.,   0.,  0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [26315789473684211./100000000000000000., 2188633911168651./50000000000000000.,       0.,  0., 0., 0.,  0.,  0., 0., 124873005504039./20000000000000000.,     20004309710957731./100000000000000000.,  -805328367804983./100000000000000000.,    423035056134793./20000000000000000.,    0.,     0.,     0.,   0.,    0.,  0.,    0.,   0.,  0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [3921722466502709./100000000000000000.,  1417496251817573./50000000000000000.,       0.,  0., 0., 0.,  0.,  0., 0., 249163204855817./100000000000000000.,    2301387878545931./100000000000000000.,   -322155956692977./100000000000000000.,    197688509889533./20000000000000000.,    -1065053856644437./50000000000000000.,      0.,     0.,   0.,    0.,  0.,    0.,   0.,  0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [20322937573209419./25000000000000000.,  343511894290243./1000000000000000.,         0.,  0., 0., 0.,  0.,  0., 0., 21045191202362739./100000000000000000.,  25856863014307603./25000000000000000.,   300151822932211./50000000000000000.,      42796906254980977./50000000000000000.,  -97723500503676681./100000000000000000.,    -66002698047929469./100000000000000000.,    0.,   0.,    0.,  0.,    0.,   0.,  0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [16666666666666667./100000000000000000., -1435740016721681./100000000000000000.,     0.,  0., 0., 0.,  0.,  0., 0., -4578165875613./125000000000000.,        3502549756362137./100000000000000000.,   721892032724227./20000000000000000.,      -2652199675536811./100000000000000000., 4456990113056981./100000000000000000.,      777144333320989./6250000000000000.,         413829693239481./100000000000000000.,     0.,    0.,  0.,    0.,   0.,  0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [9./10.,                                 35603240442512029./100000000000000000.,     0.,  0., 0., 0.,  0.,  0., 0., -2250963794737813./5000000000000000.,    4305279070837109./10000000000000000.,    3199831431318889./6250000000000000.,      45415181944320213./50000000000000000.,  -30980273342983483./25000000000000000.,     -64904866167176147./100000000000000000.,    25170890458681929./100000000000000000.,   974883087931983./1250000000000000.,        0.,  0.,    0.,   0.,  0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [6412992574519669./100000000000000000.,  1309356874065131./100000000000000000.,      0.,  0., 0., 0.,  0.,  0., 0., 0.,  0.,  0.,   0., -9320530679851./100000000000000000.,        2526871671311497./50000000000000000.,       40223517097./50000000000000000.,          59172602949417./100000000000000000.,       -8032294443./20000000000000000.,         0.,    0.,   0.,  0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [4082998185668577./20000000000000000.,   207926484466053./10000000000000000.,        0.,  0., 0., 0.,  0.,  0., 0., 0.,  0.,  0.,   0., 58269591880009./100000000000000000.,        -25053147886213./3125000000000000.,         403847643847./100000000000000000.,        8546099980555061./100000000000000000.,     -25560810117./12500000000000000.,        10532857882443189./100000000000000000.,    0.,   0.,  0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [39535039104876057./100000000000000000., 140153449795736021./100000000000000000.,    0.,  0., 0., 0.,  0.,  0., 0., 0.,  0.,  0.,   0., -11512600049211063./50000000000000000.,     -360553420233456453./50000000000000000.,    93225390173709./25000000000000000.,       -471415495727125021./100000000000000000.,  -176367657545349./100000000000000000.,   382065274019349383./50000000000000000.,    70120408731950367./20000000000000000.,    0.,  0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [60464960895123943./100000000000000000., 298786626735301717./25000000000000000.,     0.,  0., 0., 0.,  0.,  0., 0., 0.,  0.,  0.,   0., 779480932108175969./100000000000000000.,    -225800557546930317./4000000000000000.,     9123763069306449./100000000000000000.,    -636681399627174431./50000000000000000.,   -3968959219047197./100000000000000000.,  544392141883570887./10000000000000000.,    -364411637921569237./100000000000000000., -80450324991050991./100000000000000000., 0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [15917001814331423./20000000000000000.,  -14880942650710048843./100000000000000000., 0.,  0., 0., 0.,  0.,  0., 0., 0.,  0.,  0.,   0., -2293238195728141211./25000000000000000.,   70765614497159835983./100000000000000000.,  -110563611857482441./100000000000000000., 17613459188381137259./100000000000000000., 24569241210744033./50000000000000000.,   -17106950011245373609./25000000000000000., 279910604998398259./10000000000000000.,   659698550151411667./50000000000000000.,  25025756256796089./20000000000000000.,   0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [93587007425480331./100000000000000000., -241826986737049191./25000000000000000.,    0.,  0., 0., 0.,  0.,  0., 0., 0.,  0.,  0.,   0., -446990150858505531./100000000000000000.,   227563564345476341./5000000000000000.,      -7130850861838269./100000000000000000.,   140342017585515927./12500000000000000.,    394513677242571./3125000000000000.,      -272149587218427071./6250000000000000.,    39358715377152949./50000000000000000.,    26613234837234211./50000000000000000.,   42242273399632533./100000000000000000.,  8591312495030671./100000000000000000.,   0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [16666666666666667./100000000000000000., -62915020279409189./6250000000000000.,      0.,  0., 0., 0.,  0.,  0., 0., -4578165875613./125000000000000.,        3502549756362137./100000000000000000.,   721892032724227./20000000000000000.,      -2652199675536811./100000000000000000., -39193060761341509./6250000000000000.,      4820792374425629891./100000000000000000.,   -868089611420207./12500000000000000.,     1268106902048502957./100000000000000000.,  598355844841619./50000000000000000.,     -58406220624060301./1250000000000000.,     133029613326626711./100000000000000000.,  50383393751699149./50000000000000000.,   2095120519336651./100000000000000000.,   1050673531656321./50000000000000000.,    476098007208561./50000000000000000.,   0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [20322937573209419./25000000000000000.,  -40947808167774370877./100000000000000000., 0.,  0., 0., 0.,  0.,  0., 0., 21045191202362739./100000000000000000.,  25856863014307603./25000000000000000.,   300151822932211./50000000000000000.,      42796906254980977./50000000000000000.,  -25051699854744786049./100000000000000000., 97321233326194213883./50000000000000000.,   -152251941051155183./50000000000000000.,  6132829744103521419./12500000000000000.,   156647589531270907./100000000000000000., -94098714497005586681./50000000000000000., 7525922247248471753./100000000000000000., 864335892450827669./25000000000000000.,  321147679440968961./100000000000000000., -46040804173841439./100000000000000000., -1741436679683621./20000000000000000., -184837953539575767./25000000000000000.,  0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [3921722466502709./100000000000000000.,  343347475853550879./100000000000000000.,    0.,  0., 0., 0.,  0.,  0., 0., 249163204855817./100000000000000000.,    2301387878545931./100000000000000000.,   -322155956692977./100000000000000000.,    197688509889533./20000000000000000.,    54063199844480627./25000000000000000.,      -1626998645464574213./100000000000000000.,  -2570690042410491./20000000000000000.,    -898915042666504253./100000000000000000.,  -13943814529281./4000000000000000.,      63174477645335923./4000000000000000.,      -57440333091409507./100000000000000000.,  -3456020390213933./10000000000000000.,   -132448298041317./20000000000000000.,    -194447032310551./25000000000000000.,    -14243367696091./4000000000000000.,    1198206266124827./250000000000000.,       7686273243653429./50000000000000000.,    0.,   0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [9090909090909091./25000000000000000.,   3230385208719854423./100000000000000000.,   0.,  0., 0., 0.,  -63597539253241./20000000000000000.,   10079971436327401./12500000000000000.,  975983126412389./10000000000000000.,    77857557815839891./100000000000000000.,  20489042383159943./100000000000000000.,  -39065394906867047./25000000000000000.,   0., 817149459411552853./50000000000000000.,     -15454455529354362123./100000000000000000., 156971088703334873./100000000000000000.,  327685545087248131./100000000000000000.,   -1258723112984133./25000000000000000.,   15332115185804166507./100000000000000000., 44848011645482531./6250000000000000.,     -147018374337650241./50000000000000000., -6658459460768031./100000000000000000.,  -4623460549908437./100000000000000000.,  -1020993667928397./50000000000000000., -1067046212877471701./20000000000000000., -27109742943015731./20000000000000000.,  -9824767237577047./6250000000000000.,     0.,  0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [35035051988507537./50000000000000000.,  -1664514674863415129./100000000000000000.,  0.,  0., 0., 0.,  592232780324503./100000000000000000.,  47032615996384111./100000000000000000., 299688863848679./1000000000000000.,     -24765687759399491./100000000000000000., 1386187872142971./12500000000000000.,    0.,   -9834380876924583./20000000000000000.,  -114743154427289497./10000000000000000.,    321037266630492109./4000000000000000.,      -7682646079600857./20000000000000000.,    728147667468107583./100000000000000000.,   -6634969230612419./50000000000000000.,   -8107998325257307267./100000000000000000., -781484330222629./625000000000000.,       259263594969543681./100000000000000000., -15072014917320227./50000000000000000.,  11069223039491617./50000000000000000.,   8275772747718929./100000000000000000., 379921324081223041./20000000000000000.,   26923194640963969./100000000000000000.,  162674827447066537./100000000000000000.,  9834380876924583./20000000000000000.,    0.,   0., 0.,  0., 0.,        0.,  0.,  0. ],
    [14015279904218877./100000000000000000., 8384798124090527./100000000000000000.,      0.,  0., 0., 0.,  -589746835504869./50000000000000000.,  -4945980411376253./20000000000000000.,  978080858367729./10000000000000000.,    21759068924342063./100000000000000000.,  0.,  6879280338166261./50000000000000000.,     4398702297150467./100000000000000000.,  0.,     -25685040688409667./50000000000000000.,     82635569115131551./100000000000000000.,   1285090698599059163./50000000000000000.,   0.,  0.,    0.,   0.,  0.,  0.,  0.,  -1285090698599059163./50000000000000000., -82635569115131551./100000000000000000., 25685040688409667./50000000000000000.,    -4398702297150467./100000000000000000.,  -6879280338166261./50000000000000000.,    0., 0.,  0., 0.,        0.,  0.,  0. ],
    [7426709605345459./25000000000000000.,   12438052665409441./100000000000000000.,     0.,  0., 0., 2261202821975843./10000000000000000.,  1378858876180809./100000000000000000., -1680525334991711./25000000000000000.,  0., 0.,  -17124779501708567./20000000000000000.,  -196337522866858909./100000000000000000., -1161664113620597./5000000000000000.,   0.,     430660719086453349./100000000000000000.,    -292722963249465483./100000000000000000., -1646263332795717889./20000000000000000.,  0.,  0.,    0.,   0.,  0.,  0.,  0.,  1646263332795717889./20000000000000000.,  292722963249465483./100000000000000000., -430660719086453349./100000000000000000., 1161664113620597./5000000000000000.,     196337522866858909./100000000000000000.,  17124779501708567./20000000000000000.,  0.,  0., 0.,        0.,  0.,  0. ],
    [16749674481819323./25000000000000000.,  5174228081833989./50000000000000000.,       0.,  0., 6103444365320361./50000000000000000., 24128724516562331./50000000000000000., -381409600015607./10000000000000000.,  0., -6881244066385029./12500000000000000.,  0.,  -71191581158518923./100000000000000000., -29206480283577567./50000000000000000.,   0., 0.,     52761577031466233./25000000000000000.,      -8374947367395721./100000000000000000.,   255010749536160457./50000000000000000.,    0.,  0.,    0.,   0.,  0.,  0.,  0.,  -255010749536160457./50000000000000000.,  8374947367395721./100000000000000000.,   -52761577031466233./25000000000000000.,   0.,  29206480283577567./50000000000000000.,    71191581158518923./100000000000000000., 6881244066385029./12500000000000000.,    0., 0.,        0.,  0.,  0. ],
    [33333333333333333./100000000000000000., 19333333333333333./100000000000000000.,     0.,  11./50.,                                -2./25.,                              0.,  0.,  1099934255807247./10000000000000000.,   -3178713100953377./12500000000000000.,  0.,  3462283108466777./4000000000000000.,     332416449114093083./100000000000000000.,  0., 0.,     -1201022233159779339./100000000000000000.,  11915036656062331./25000000000000000.,    -580486022442072781./20000000000000000.,   0.,  0.,    0.,   0.,  0.,  0.,  0.,  580486022442072781./20000000000000000.,   -11915036656062331./25000000000000000.,  1201022233159779339./100000000000000000., 0.,  -332416449114093083./100000000000000000., -3462283108466777./4000000000000000.,   3178713100953377./12500000000000000.,    -1099934255807247./10000000000000000.,  0.,        0.,  0.,  0. ],
    [13888888888888889./25000000000000000.,  -83333333333333333./100000000000000000.,    138888888888888889./100000000000000000., 0., 0., -3./4.,                                0.,  -4925295437180263./10000000000000000.,  0., 0.,  0.,  0.,   0., 0.,     0.,     0.,   0.,    0.,  0.,    0.,   0.,  0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  4925295437180263./10000000000000000.,   3./4.,     0.,  0.,  0. ],
    [11111111111111111./100000000000000000., 11111111111111111./100000000000000000.,     0.,  -11111111111111111./50000000000000000., 0., 0.,  0.,  0., 0., 0.,  0.,  0.,   0., 0.,     0.,     0.,   0.,    0.,  0.,    0.,   0.,  0.,  0.,  0.,  0.,   0.,  0.,   0.,  0.,   0., 0.,  0., 0.,        11111111111111111./50000000000000000., 0.,  0. ],
    [1./1.,                                  7145878509724289./25000000000000000.,       29166666666666667./100000000000000000.,  7./32.,                                 0., 21./128.,                              0.,  10909717747277833./50000000000000000.,  18039289847869777./100000000000000000., 0.,  10285691970242251./50000000000000000.,   94810856086629./390625000000000.,         24646578081362931./100000000000000000., -13799677631635633./4000000000000000.,      2860944527000451./12500000000000000.,       14164529985107571./50000000000000000.,    321085125837766641./100000000000000000.,   -2235387773648457./10000000000000000.,   -70712115720441907./100000000000000000.,   8028083628757177./2500000000000000.,      70477174154834883./50000000000000000.,   -15136205344374261./100000000000000000., 9308764363175357./25000000000000000.,    12648937320318067./50000000000000000., -321085125837766641./100000000000000000., -14164529985107571./50000000000000000.,  -2860944527000451./12500000000000000.,    -24646578081362931./100000000000000000., -94810856086629./390625000000000.,        -10285691970242251./50000000000000000., -18039289847869777./100000000000000000., -10909717747277833./50000000000000000., -21./128., -7./32.,                               -29166666666666667./100000000000000000., 0. ]], dtype=numpy.float64
    )

    C = tableau[:,0]
    A = tableau[:,1:] 
    B = numpy.array([892857142857143./50000000000000000., 3./512., 3./256., 0., 9./512., 0., 3./128., 15./512., 0., 9./256., 21./512., 3./64., 0., 27./512., 15./256., 33./512., 0., 5267605678587651./50000000000000000., 8528067312087609./50000000000000000., 10311469866467597./50000000000000000., 10311469866467597./50000000000000000., 8528067312087609./50000000000000000., 5267605678587651./50000000000000000., -33./512., -15./256., -27./512., -3./64., -21./512., -9./256., -15./512., -3./128., -9./512., -3./256., -3./512., 892857142857143./50000000000000000.])
    # B_hat
    E = numpy.array([892857142857143./50000000000000000., 242968749999999999./50000000000000000000., 3./256., 0., 9./512., 0., 3./128., 15./512., 0., 9./256., 21./512., 3./64., 0., 27./512., 15./256., 33./512., 0., 5267605678587651./50000000000000000., 8528067312087609./50000000000000000., 10311469866467597./50000000000000000., 10311469866467597./50000000000000000., 8528067312087609./50000000000000000., 5267605678587651./50000000000000000., -33./512., -15./256., -27./512., -3./64., -21./512., -9./256., -15./512., -3./128., -9./512., -3./256., -242968749999999999./50000000000000000000., 892857142857143./50000000000000000., 0.])
    E[:-1] -= B 

class DP87(RungeKutta): 
    # Dormand Prince 8(7) scheme
    order = 8
    error_estimator_order = 7
    n_stages = 13

    tableau = numpy.array(
        [[0.0,                    0.0,                  0.0,      0.0,       0.0,                      0.0,                    0.0,                     0.0,                     0.0,                     0.0,                     0.0,                   0.0,                  0.0, 0.0],
         [1/18,                   1/18,                 0.0,      0.0,       0.0,                      0.0,                    0.0,                     0.0,                     0.0,                     0.0,                     0.0,                   0.0,                  0.0, 0.0],
         [1/12,                   1/48,                 1/16,     0.0,       0.0,                      0.0,                    0.0,                     0.0,                     0.0,                     0.0,                     0.0,                   0.0,                  0.0, 0.0],
         [1/8,                    1/32,                 0.0,      3/32,      0.0,                      0.0,                    0.0,                     0.0,                     0.0,                     0.0,                     0.0,                   0.0,                  0.0, 0.0],
         [5/16,                   5/16,                 0.0,     -75/64,     75/64,                    0.0,                    0.0,                     0.0,                     0.0,                     0.0,                     0.0,                   0.0,                  0.0, 0.0],
         [3/8,                    3/80,                 0.0,      0.0,       3/16,                     3/20,                   0.0,                     0.0,                     0.0,                     0.0,                     0.0,                   0.0,                  0.0, 0.0],
         [59/400,                 29443841/614563906,   0.0,      0.0,       77736538/692538347,      -28693883/1125000000,    23124283/1800000000,     0.0,                     0.0,                     0.0,                     0.0,                   0.0,                  0.0, 0.0],
         [93/200,                 16016141/946692911,   0.0,      0.0,       61564180/158732637,       22789713/633445777,     545815736/2771057229,   -180193667/1043307555,    0.0,                     0.0,                     0.0,                   0.0,                  0.0, 0.0],
         [5490023248/9719169821,  39632708/573591083,   0.0,      0.0,      -433636366/683701615,     -421739975/2616292301,   100302831/723423059,     790204164/839813087,     800635310/3783071287,    0.0,                     0.0,                   0.0,                  0.0, 0.0],
         [13/20,                  246121993/1340847787, 0.0,      0.0,      -37695042795/15268766246, -309121744/1061227803,  -12992083/490766935,      6005943493/2108947869,   393006217/1396673457,    123872331/1001029789,    0.0,                   0.0,                  0.0, 0.0],
         [1201146811/1299019798, -1028468189/846180014, 0.0,      0.0,       8478235783/508512852,     1311729495/1432422823, -10304129995/1701304382, -48777925059/3047939560,  15336726248/1032824649, -45442868181/3398467696,  3065993473/597172653,  0.0,                  0.0, 0.0],
         [1,                      185892177/718116043,  0.0,      0.0,      -3185094517/667107341,    -477755414/1098053517,  -703635378/230739211,     5731566787/1027545527,   5232866602/850066563,   -4093664535/808688257,    3962137247/1805957418, 65686358/487910083,   0.0, 0.0],
         [1,                      403863854/491063109,  0.0,      0.0,      -5068492393/434740067,    -411421997/543043805,    652783627/914296604,     11173962825/925320556,  -13158990841/6184727034,  3936647629/1978049680,  -160528059/685178525,   248638103/1413531060, 0.0, 0.0]], dtype=numpy.float64
    )
    C = tableau[:,0]
    A = tableau[:,1:]
    B = numpy.array([13451932/455176623, 0.0, 0.0, 0.0, 0.0, -808719846/976000145, 1757004468/5645159321, 656045339/265891186, -3867574721/1518517206, 465885868/322736535,  53011238/667516719,   2/45,0.0]) 
    E = numpy.array([14005451/335480064, 0.0, 0.0, 0.0, 0.0, -59238493/1068277825, 181606767/758867731,   561292985/797845732, -1041891430/1371343529, 760417239/1151165299, 118820643/751138087, -528747749/2220607170, 1/4, 0.])
    E[:-1] -= B 

class F10_8(RungeKutta):
    # Feagin 10(8)
    order = 10
    error_estimator_order = 8
    n_stages = 17

    tableau = numpy.array(
        [[0.,                                           0.,                                           0.,                                          0.,                                            0.,                                          0.,                                           0.,                                            0.,                                            0.,                                            0.,                                           0.,                                             0.,                                             0.,                                            0.,                                           0.,                                            0.,                                           0.,       0., ],
    [1./10.,                                       1./10.,                                       0.,                                          0.,                                            0.,                                          0.,                                           0.,                                            0.,                                            0.,                                            0.,                                           0.,                                             0.,                                             0.,                                            0.,                                           0.,                                            0.,                                           0.,       0., ],
    [53935784080298178753./100000000000000000000., -22879414034382286013./25000000000000000000., 29090688043565464561./20000000000000000000., 0.,                                            0.,                                          0.,                                           0.,                                            0.,                                            0.,                                            0.,                                           0.,                                             0.,                                             0.,                                            0.,                                           0.,                                            0.,                                           0.,       0., ],
    [8090367612044726813./10000000000000000000.,   2528239878763977129./12500000000000000000.,   0.,                                          60677757090335451097./100000000000000000000.,  0.,                                          0.,                                           0.,                                            0.,                                            0.,                                            0.,                                           0.,                                             0.,                                             0.,                                            0.,                                           0.,                                            0.,                                           0.,       0., ],
    [3090367612044726813./10000000000000000000.,   3680494294172871503./20000000000000000000.,   0.,                                          19796683122719236907./100000000000000000000.,  -1823869618284081573./25000000000000000000., 0.,                                           0.,                                            0.,                                            0.,                                            0.,                                           0.,                                             0.,                                             0.,                                            0.,                                           0.,                                            0.,                                           0.,       0., ],
    [3924296760879181073./4000000000000000000.,    8790073402066813373./100000000000000000000.,  0.,                                          0.,                                            10261492563006516133./25000000000000000000., 1206784384197166223./2500000000000000000.,    0.,                                            0.,                                            0.,                                            0.,                                           0.,                                             0.,                                             0.,                                            0.,                                           0.,                                            0.,                                           0.,       0., ],
    [83333333333333333333./100000000000000000000., 4298502524512301511./50000000000000000000.,   0.,                                          0.,                                            6617719260814443679./20000000000000000000.,  12241573932736254821./25000000000000000000.,  -914820468838563421./12500000000000000000.,    0.,                                            0.,                                            0.,                                           0.,                                             0.,                                             0.,                                            0.,                                           0.,                                            0.,                                           0.,       0., ],
    [35401736585680237633./100000000000000000000., 6046522456266686033./50000000000000000000.,   0.,                                          0.,                                            0.,                                          26012467575829562281./100000000000000000000., 1627013107745456651./50000000000000000000.,    -186181316192925313./3125000000000000000.,     0.,                                            0.,                                           0.,                                             0.,                                             0.,                                            0.,                                           0.,                                            0.,                                           0.,       0., ],
    [88252766196473234643./100000000000000000000., 11085437958039148351./100000000000000000000., 0.,                                          0.,                                            0.,                                          0.,                                           -1514403720637513969./25000000000000000000.,   3217637056017783901./10000000000000000000.,    25524286280403151579./50000000000000000000.,   0.,                                           0.,                                             0.,                                             0.,                                            0.,                                           0.,                                            0.,                                           0.,       0., ],
    [2008174244501007963./3125000000000000000.,    11205441475287900483./100000000000000000000., 0.,                                          0.,                                            0.,                                          0.,                                           -14494277590286591567./100000000000000000000., -33326971909625670659./100000000000000000000., 9985384591137601227./20000000000000000000.,    6368807611621076303./12500000000000000000.,   0.,                                             0.,                                             0.,                                            0.,                                           0.,                                            0.,                                           0.,       0., ],
    [1116825755498992037./3125000000000000000.,    5698839198209299307./50000000000000000000.,   0.,                                          0.,                                            0.,                                          0.,                                           -3844066821016784693./50000000000000000000.,   23952736032439064911./100000000000000000000.,  7955493247361892781./20000000000000000000.,    268897392184018639./25000000000000000000.,    -6555382483280377483./20000000000000000000.,    0.,                                             0.,                                            0.,                                           0.,                                            0.,                                           0.,       0., ],
    [11747233803526765357./100000000000000000000., 498946580175122529./6250000000000000000.,     0.,                                          0.,                                            0.,                                          0.,                                           -1040659373601206153./20000000000000000000.,   -5769541461685488817./100000000000000000000.,  9739095785605208249./50000000000000000000.,    14538492318832506973./100000000000000000000., -122334798492448559./1562500000000000000.,      -5725164968054945609./50000000000000000000.,    0.,                                            0.,                                           0.,                                            0.,                                           0.,       0., ],
    [83333333333333333333./100000000000000000000., 24627890254121432003./25000000000000000000.,  0.,                                          0.,                                            6617719260814443679./20000000000000000000.,  12241573932736254821./25000000000000000000.,  -68948243287421783791./50000000000000000000.,  -86116419502763566667./100000000000000000000., 578428813637537220023./100000000000000000000., 32880776198510356689./10000000000000000000.,  -238633905093136384013./100000000000000000000., -65095868496728783731./20000000000000000000.,   -108171770843211491177./50000000000000000000., 0.,                                           0.,                                            0.,                                           0.,       0., ],
    [3090367612044726813./10000000000000000000.,   17901605915432657821./20000000000000000000.,  0.,                                          19796683122719236907./100000000000000000000.,  -1823869618284081573./25000000000000000000., 0.,                                           -42561811983100380987./50000000000000000000.,  9958002807963332543./25000000000000000000.,    363937263181035606029./100000000000000000000., 30964575407966064473./20000000000000000000.,  -106110857352026858013./50000000000000000000.,  -158350398545326172713./100000000000000000000., -85780804142968132461./50000000000000000000.,  -2440364057501274521./100000000000000000000., 0.,                                            0.,                                           0.,       0., ],
    [53935784080298178753./100000000000000000000., -22879414034382286013./25000000000000000000., 29090688043565464561./20000000000000000000., 0.,                                            0.,                                          -38866682182248411677./50000000000000000000., 0.,                                            -1138619577693970087./12500000000000000000.,   0.,                                            0.,                                           0.,                                             0.,                                             0.,                                            1138619577693970087./12500000000000000000.,   38866682182248411677./50000000000000000000.,   0.,                                           0.,       0., ],
    [1./10.,                                       1./10.,                                       0.,                                          -15717866579977116337./100000000000000000000., 0.,                                          0.,                                           0.,                                            0.,                                            0.,                                            0.,                                           0.,                                             0.,                                             0.,                                            0.,                                           0.,                                            15717866579977116337./100000000000000000000., 0.,       0., ],
    [1./1.,                                        18178130070009528389./100000000000000000000., 27./40.,                                     17137907992359491997./50000000000000000000.,   0.,                                          25911121454832274451./100000000000000000000., -7165579334359041781./20000000000000000000.,   -20918979188176661219./20000000000000000000.,  93032784541562698329./100000000000000000000.,  88975479715854051223./50000000000000000000.,  1./10.,                                         -28254756953904408161./100000000000000000000.,  -15932735011997254917./100000000000000000000., -7275794732350075543./50000000000000000000.,  -25911121454832274451./100000000000000000000., -17137907992359491997./50000000000000000000., -27./40., 0., ]], dtype=numpy.float64
    )

    final_state = numpy.array(
        [[0., 3333333333333333333./100000000000000000000., 1./40., 3333333333333333333./100000000000000000000., 0., 1./20., 0., 1./25., 0., 2365468476861543627./12500000000000000000., 27742918851774317651./100000000000000000000., 27742918851774317651./100000000000000000000., 2365468476861543627./12500000000000000000., -1./25., -1./20., -3333333333333333333./100000000000000000000., -1./40., 3333333333333333333./100000000000000000000.],
         [0., 3333333333333333333./100000000000000000000., 1./36., 3333333333333333333./100000000000000000000., 0., 1./20., 0., 1./25., 0., 2365468476861543627./12500000000000000000., 27742918851774317651./100000000000000000000., 27742918851774317651./100000000000000000000., 2365468476861543627./12500000000000000000., -1./25., -1./20., -3333333333333333333./100000000000000000000., -1./36., 3333333333333333333./100000000000000000000.]], dtype=numpy.float64
    )
    C = tableau[:,0]
    A = tableau[:,1:]
    B = numpy.array([3333333333333333333./100000000000000000000., 1./40., 3333333333333333333./100000000000000000000., 0., 1./20., 0., 1./25., 0., 2365468476861543627./12500000000000000000., 27742918851774317651./100000000000000000000., 27742918851774317651./100000000000000000000., 2365468476861543627./12500000000000000000., -1./25., -1./20., -3333333333333333333./100000000000000000000., -1./40., 3333333333333333333./100000000000000000000.])
    E = numpy.array([3333333333333333333./100000000000000000000., 1./36., 3333333333333333333./100000000000000000000., 0., 1./20., 0., 1./25., 0., 2365468476861543627./12500000000000000000., 27742918851774317651./100000000000000000000., 27742918851774317651./100000000000000000000., 2365468476861543627./12500000000000000000., -1./25., -1./20., -3333333333333333333./100000000000000000000., -1./36., 3333333333333333333./100000000000000000000., 0.])
    E[:-1] -= B


METHODS = {'BS3(2)'              : BS32,
           'DP5(4)'              : DP54,
           'M4(3)'               : M43,
           'KC3(2)'              : KC32,
           'EXLRK3(2)'           : ExLRK32,
           'EXLRK4(3)'           : ExLRK43,
           'F14(12)'             : F14_12,
           'DP8(7)'              : DP87,
           'F10(8)'              : F10_8}
